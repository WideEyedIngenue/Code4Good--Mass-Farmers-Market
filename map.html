<!DOCTYPE html>
<html>
<head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
        /* Always set the map height explicitly to define the size of the div
         * element that contains the map. */
        #map {
            height: 100%;
        }
        /* Optional: Makes the sample page fill the window. */
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
    <script src="papaparse.min.js"></script>
    <script>
        /**
         * Filters out non-HIP markets
         */
        function filterHIP(){
            for(var i = 0; i < data.length; i++){
                if (data[i].HIP == 0){
                    markers[i].setMap(null); //Makes marker disappear from map
                }
            }
        }

        function filterSNAP() {
            for(var i = 0 ; i < data.length; i++) {
                if (data[i]["SNAP/EBT"] == 0) {
                    markers[i].setMap(null);
                }
            }
        }
    </script>
    <div id="button">
        <!--Creates a button with HIP text-->
        <button type="button" onClick="filterHIP()">HIP</button>
        <button type="button" onClick="filterSNAP()">SNAP</button>
    </div>
    <div id="map"></div>

    <div id="button2">
        <button type="button" onClick="filterSNAP()">SNAP</button>
    </div>

    <script>
        var data;
        var markers = []; //Empty array
        var infowindows = [];

        /**
         * Initializes map with markers and data
         */
        function initMap() {
            var csvFile = 'tweak.csv' //CSV  with farmer's market data
            var boston = {lat: 42.359884, lng: -71.058813}; //Location of Boston
            var map = new google.maps.Map(
                document.getElementById('map'), {zoom: 8, center: boston}); //Creates map centered on Boston
            Papa.parse(csvFile, { //Gets data from the CSV
                header: true,
                download: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function (results) {
                    console.log(results);
                    data = results.data;
                    for (var i = 0; i < data.length; i++) {
                        if (data[i].Latitude != 0 && data[i].Longitude != 0) {
                            var location = {lat: data[i].Latitude, lng: data[i].Longitude}; //Gets location of each farmer's market
                            var marker = new google.maps.Marker({position: location, map: map}) //Creates a marker and places it on the map
                            markers.push(marker);
                            //Stores marker in array
                            //creating info pop up windows for each marker
                            //more info needs to be added later in content string
                                //eg snap, hip, hours, days
                                //content string ideally would be in html to accomodate this

                            var contentString = data[i]["Market Name"]
                            var infowindow = new google.maps.InfoWindow ({
                                content : contentString
                            });
                            marker.infowindow = infowindow;
                            marker.addListener('click',function() {
                                return this.infowindow.open(map,this);
                            })
                            infowindows.push(infowindow);
                        }

                    }

                }
            })
        }

    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDlg_RXppjqCe1dTW8XW2xBYgmq84-O-xQ&callback=initMap"
        async defer></script>
</body>
</html>